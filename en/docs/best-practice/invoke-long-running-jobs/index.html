<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-best-practice/invoke-long-running-jobs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Organize Long Tasks | Rill FLow</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://rill-flow.github.io/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://rill-flow.github.io/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://rill-flow.github.io/en/docs/best-practice/invoke-long-running-jobs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Organize Long Tasks | Rill FLow"><meta data-rh="true" name="description" content="We define tasks with a time limit of more than 10 s as “long tasks”, where the results of the mission cannot be obtained immediately, and we need to wait for the end of the mandate before proceeding to the next node."><meta data-rh="true" property="og:description" content="We define tasks with a time limit of more than 10 s as “long tasks”, where the results of the mission cannot be obtained immediately, and we need to wait for the end of the mandate before proceeding to the next node."><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://rill-flow.github.io/en/docs/best-practice/invoke-long-running-jobs"><link data-rh="true" rel="alternate" href="https://rill-flow.github.io/en/docs/best-practice/invoke-long-running-jobs" hreflang="en"><link data-rh="true" rel="alternate" href="https://rill-flow.github.io/docs/best-practice/invoke-long-running-jobs" hreflang="zh"><link data-rh="true" rel="alternate" href="https://rill-flow.github.io/docs/best-practice/invoke-long-running-jobs" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.eb4153ca.css">
<script src="/en/assets/js/runtime~main.61291073.js" defer="defer"></script>
<script src="/en/assets/js/main.d913a192.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="Rill Flow logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo.svg" alt="Rill Flow logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Rill Flow</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/weibocom/rill-flow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/en/docs/best-practice/invoke-long-running-jobs" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/docs/best-practice/invoke-long-running-jobs" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/快速开始">Quick Start</a><button aria-label="Expand sidebar category &#x27;Quick Start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/用户指南">User Guide</a><button aria-label="Expand sidebar category &#x27;User Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/最佳实践">Best practices</a><button aria-label="Collapse sidebar category &#x27;Best practices&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/best-practice/customize-executor">Custom Executor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/best-practice/invoke-long-running-jobs">Organize Long Tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/best-practice/work-with-servless">Server Access Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/best-practice/work-with-llms">Angular model</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/开发者指南">Developer Guide</a><button aria-label="Expand sidebar category &#x27;Developer Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/faq">FAQ</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/最佳实践"><span itemprop="name">Best practices</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Organize Long Tasks</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Organize Long Tasks</h1>
<p>We define tasks with a time limit of more than 10 s as “long tasks”, where the results of the mission cannot be obtained immediately, and we need to wait for the end of the mandate before proceeding to the next node.</p>
<p>Rill Flow is designed to keep the process context stored and therefore does not lose the context of the process execution even if it is restarted or upgraded in the long task.</p>
<p>We divide our common long tasks into four categories, and Bill Flow can be interfaced with these types of long tasks in different ways.</p>
<blockquote>
<p>In practice, it is not recommended that the Rill Flow arrangement be used for tasks that have been carried out for more than one month (of course, it can be organized).</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="receive-call---waiting-for-long-tasks">Receive call - waiting for long tasks<a href="#receive-call---waiting-for-long-tasks" class="hash-link" aria-label="Direct link to Receive call - waiting for long tasks" title="Direct link to Receive call - waiting for long tasks">​</a></h2>
<p>Once a mission is launched, it will be necessary to synchronize and wait for the interface to return. Depending on the mode of deployment of the corresponding service, there can be two interfaces with：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="call-the-cloud-servicedispatcher-to-create-an-asynchronous-thread-pool">Call the cloud service：dispatcher to create an asynchronous thread pool<a href="#call-the-cloud-servicedispatcher-to-create-an-asynchronous-thread-pool" class="hash-link" aria-label="Direct link to Call the cloud service：dispatcher to create an asynchronous thread pool" title="Direct link to Call the cloud service：dispatcher to create an asynchronous thread pool">​</a></h3>
<p>When the corresponding execution service is deployed on the public website, it can be done by adding asynchronous execution thread pools to the dispatcher, avoiding sending threads to be packed for long periods of time by long assignments. Please refer to the <code>ChatGPT</code> plugin in the code.</p>
<blockquote>
<p>When the Rill Flow service itself restarts, the corresponding request will also be lost. Elegant shutdown related logic will need to be added to the dispatcher</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="adds-an-executor-agent-with">Adds an executor Agent with：<a href="#adds-an-executor-agent-with" class="hash-link" aria-label="Direct link to Adds an executor Agent with：" title="Direct link to Adds an executor Agent with：">​</a></h3>
<p>When the corresponding executor is self-serving, it is recommended that an additional call be made to the service by Sidecar, with a request from Agent to maintain the service as well as the actual service and that the agency return Rill Flow at the end of the request to notify the task execution.</p>
<p><img loading="lazy" alt="executor agent" src="/en/assets/images/executor-agent-d81ee43b6e5574be4d1b4184fd317e13.svg" width="543" height="132" class="img_ev3q"></p>
<p>By adding Agent, it is effective to avoid failure of long connection requests due to network or other problems.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="for-call-poll-long-tasks">For call-poll long tasks<a href="#for-call-poll-long-tasks" class="hash-link" aria-label="Direct link to For call-poll long tasks" title="Direct link to For call-poll long tasks">​</a></h2>
<p>Get token, after launching the task, and then get progress through the Task Query Interface.</p>
<ul>
<li>Add two nodes to the process</li>
<li>Passing token between tasks through the parameter mapper</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="for-call-back-long-tasks">For call-back long tasks<a href="#for-call-back-long-tasks" class="hash-link" aria-label="Direct link to For call-back long tasks" title="Direct link to For call-back long tasks">​</a></h2>
<p>Assign callback when launching the task and call the specified interface when the task is complete.</p>
<p>Return the Rill Flow to complete the interface directly in the task, or the business implements the callback logic by converting the original task request to encapsulate and then calling to Rill Flow.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="for-stream-long-tasks">For stream long tasks<a href="#for-stream-long-tasks" class="hash-link" aria-label="Direct link to For stream long tasks" title="Direct link to For stream long tasks">​</a></h2>
<p>Once a mission is launched, it will be possible to write data continuously to a certain inflows.</p>
<p>Rill Flow currently does not support original streaming task configuration, and needs to encapsulate flow logic to Executor itself.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://crowdin.com/project/rill-flow/en" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/best-practice/customize-executor"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom Executor</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/best-practice/work-with-servless"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Server Access Service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#receive-call---waiting-for-long-tasks" class="table-of-contents__link toc-highlight">Receive call - waiting for long tasks</a><ul><li><a href="#call-the-cloud-servicedispatcher-to-create-an-asynchronous-thread-pool" class="table-of-contents__link toc-highlight">Call the cloud service：dispatcher to create an asynchronous thread pool</a></li><li><a href="#adds-an-executor-agent-with" class="table-of-contents__link toc-highlight">Adds an executor Agent with：</a></li></ul></li><li><a href="#for-call-poll-long-tasks" class="table-of-contents__link toc-highlight">For call-poll long tasks</a></li><li><a href="#for-call-back-long-tasks" class="table-of-contents__link toc-highlight">For call-back long tasks</a></li><li><a href="#for-stream-long-tasks" class="table-of-contents__link toc-highlight">For stream long tasks</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weibo.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Weibo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/weibocom/rill-flow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ©️ 2024 Weibo, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>